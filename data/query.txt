// order total quantity calculation
SELECT
    id,
    stock_id,
    sku,
    product_name,
    SUM(quantity) AS total_quantity
FROM
    orders
WHERE
    created_at BETWEEN '2025-07-01' AND '2025-08-31'
GROUP BY
    sku,
    product_name
ORDER BY
    `orders`.`stock_id` ASC


// see sale point from orderInvoice table
SELECT
    oi.*
FROM
    order_invoices oi
JOIN sale_points sp ON
    sp.id = oi.sale_point_id
WHERE
    sp.code_number = 'WGP273';

// update orderInvoice table for type // done
UPDATE
    order_invoices oi
JOIN order_order_invoice ooi ON
    oi.id = ooi.order_invoice_id
JOIN orders o ON
    ooi.order_id = o.id
JOIN stocks s ON
    o.stock_id = s.id
JOIN products p ON
    s.product_id = p.id
JOIN categories c ON
    p.category_id = c.id
SET
    oi.type = CASE WHEN c.slug = 'seed' THEN 'seed' ELSE 'agrochemicals'
END;

// update orderInvoice table for depot_id // done
UPDATE
    order_invoices
SET
    depot_id = CASE WHEN TYPE = 'seed' THEN 1 WHEN TYPE = 'agrochemicals' THEN 2
END;

// udate the due field for credit payment_type
UPDATE
    order_invoices
SET
    due = total_amount
WHERE
    payment_type = 'Credit';

// udate the due field for cash payment_type
UPDATE
    order_invoices
SET
    due = total_amount -(
        total_amount *(discount / 100)
    )
WHERE
    payment_type = 'Cash';


// find invoices for sku
SELECT
    oi.invoice_number,
    oi.depot_id,
    o.order_number,
    o.sku,
    o.quantity,
    o.unit_price,
    o.total_amount
FROM
    orders o
JOIN order_order_invoice ooi ON
    o.id = ooi.order_id
JOIN order_invoices oi ON
    oi.id = ooi.order_invoice_id
WHERE
    o.sku = 'SSG6789';


// product wise sales report
SELECT
    p.title AS product_name,
    o.sku,
    DATE(MIN(oi.invoice_date)) AS start_date,
    DATE(MAX(oi.invoice_date)) AS end_date,
    SUM(o.quantity) AS total_sold_qty,
    SUM(o.total_amount) AS total_sales_amount
FROM
    orders o
JOIN order_order_invoice ooi ON
    ooi.order_id = o.id
JOIN order_invoices oi ON
    oi.id = ooi.order_invoice_id
JOIN products p ON
    p.sku = o.sku
WHERE
    oi.status = 'Accepted' AND oi.invoice_date BETWEEN '2025-07-01' AND '2025-11-11'
GROUP BY
    p.title,
    o.sku
ORDER BY
    total_sold_qty
DESC